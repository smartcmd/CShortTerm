# C语言短学期-扫雷

## 项目介绍

该项目是一个个人编程项目，重点是学习如何使用C语言。本程序是一个基于命令行的扫雷游戏，用户通过输入指令来操作游戏。

此扫雷游戏允许自定义棋盘大小和难度，难度由地雷密度决定。所有用户输入都将采用`cmd x y`的形式，`cmd`将定义具体的游戏命令，`x`和`y`是否需要输入取决于`cmd`的值，如果命令需要，则用户同时需要输入坐标。

## 编译并运行此项目

### 工具链

本项目选用了[Xmake](https://xmake.io/#/)作为构建系统。`Xmake`是一款基于`Lua`的轻量级跨平台编译工具。与`Makefile`或 `CMake`相比，`Xmake`的配置语法更加简洁直观。因此，它对新手很友好，同时还能保持构建系统所需的灵活性。有了`Xmake`，你可以专注于你的项目而不是构建。

笔者当前使用的`Xmake`版本是`v2.9.6`。若你遇到任何编译错误，可尝试切换`Xmake`版本至此版本。

除了需要安装`Xmake`，你还需要安装MSVC(Microsoft Visual C++)工具链，安装方法请自行查找文档，笔者当前使用的版本是：
```
checking for Microsoft Visual Studio (x64) version ... 2022
checking for Microsoft C/C++ Compiler (x64) version ... 19.42.34435
```

本项目在Windows环境上可以通过编译，理论上也可以在其他平台通过编译（未测试）

### 运行

最简单的办法是直接在终端运行命令：
```cmd
xmake run
```
此命令将自动构建本项目，输出exe文件到build/<platform>/<arch>/<mode>下，并在项目根目录运行exe。请注意，只能在项目根目录运行exe文件，因为程序在运行时需要读取同目录下`resources/game`下的三个资源文件：`loss.txt`, `welcome.txt`, `win.txt`。为避免出现编码问题，游戏内全部使用英文输出。

也可以只编译项目而不运行：
```cmd
xmake build
```

更多细节请参考`Xmake`官方文档

## 如何游玩

启动游戏时，你会看到一个欢迎屏幕，询问您是否愿意开始游戏。输入`Y`会进入游戏选项，输入`N`则会关闭游戏。输入`Y`后，你可以输入游戏板的高度和宽度以及地雷的数量。你最多可以将游戏板面积的 26% 覆盖在地雷上，但请记住，地雷越多，游戏越难。
```console
    __  ____           _____                                  
   /  |/  (_)___  ___ / ___/      _____  ___  ____  ___  _____
  / /|_/ / / __ \/ _ \\__ \ | /| / / _ \/ _ \/ __ \/ _ \/ ___/
 / /  / / / / / /  __/__/ / |/ |/ /  __/  __/ /_/ /  __/ /    
/_/  /_/_/_/ /_/\___/____/|__/|__/\___/\___/ .___/\___/_/     
                              coded in C  /_/ v. 0.5.0

Start New Game? Y/N: Y

Enter Height (Max 24): 10

Enter Width (Max 32): 10

Enter Mines (Up to 26 percent of board area, max 200): 20

Turn: 0
 9 [*][*][*][*][*][*][*][*][*][*]
 8 [*][*][*][*][*][*][*][*][*][*]
 7 [*][*][*][*][*][*][*][*][*][*]
 6 [*][*][*][*][*][*][*][*][*][*]
 5 [*][*][*][*][*][*][*][*][*][*]
 4 [*][*][*][*][*][*][*][*][*][*]
 3 [*][*][*][*][*][*][*][*][*][*]
 2 [*][*][*][*][*][*][*][*][*][*]
 1 [*][*][*][*][*][*][*][*][*][*]
 0 [*][*][*][*][*][*][*][*][*][*]
    0  1  2  3  4  5  6  7  8  9  
Enter a command:   
```

### 帮助命令

如果你在游玩游戏时忘记了游戏命令的用法，你可以键入`h`或`help`来打印所有可用的命令，输出如下：
``` console
Enter a command: help
Commands:
	r/reveal [row] [col]	Reveal a square
	m/mark [row] [col]		Flag a square
	g/guess [row] [col]		Guess a square
	h/help        		Print help
	q/quit        		Quit to menu
	c/close       		Quit the program
```

### 揭示命令

揭示命令是你开始找雷所需的第一个命令。输入`r`或`reveal`，然后输入相应的行和列，就会显示一块方砖，并打印出相邻方砖中有多少地雷。示例如下：
``` console
Enter a command: r 0 0

Turn: 1
 9 [*][*][*][*][*][*][*][*][*][*]
 8 [*][*][*][*][*][*][*][*][*][*]
 7 [*][*][*][*][*][*][*][*][*][*]
 6 [*][*][*][*][*][*][*][*][*][*]
 5 [*][*][*][*][*][*][*][*][*][*]
 4 [*][*][*][*][*][*][*][*][*][*]
 3 [*][*][*][*][*][*][*][*][*][*]
 2 [*][*][*][*][*][*][*][*][*][*]
 1 [*][*][*][*][*][*][*][*][*][*]
 0 [1][*][*][*][*][*][*][*][*][*]
    0  1  2  3  4  5  6  7  8  9 
```
如上图所示，第`0`行第`0`列的瓦片被揭示，并显示相邻格中有一个地雷。揭示功能是递归的，也就是说，如果您揭示了相邻有`0`个地雷的格，它将揭示其周围的所有格，直到不再有相邻没有地雷的格。

下图是一个示例，其中`2` `1`已被揭示，而`0` `0`已被揭示：
```console
Enter a command: r 2 1

Turn: 2
 9 [*][*][*][*][*][*][*][*][*][*]
 8 [*][*][*][*][*][*][*][*][*][*]
 7 [*][*][*][*][*][*][*][*][*][*]
 6 [*][*][*][*][*][*][*][*][*][*]
 5 [1][3][*][*][*][*][*][*][*][*]
 4 [0][1][*][*][*][*][*][*][*][*]
 3 [0][2][1][*][*][*][*][*][*][*]
 2 [0][0][1][*][*][*][*][*][*][*]
 1 [1][1][1][*][*][*][*][*][*][*]
 0 [1][*][*][*][*][*][*][*][*][*]
    0  1  2  3  4  5  6  7  8  9  
```

### 标记命令

标记是赢得游戏的基本工具。要赢得游戏，所有地雷都必须插上旗子，但不能有额外的旗子。这意味着，在此版本中，你需要`20`个旗子才能获胜。下面的棋盘是一个有效的获胜条件：
```console
 9 [F][*][*][*][*][*][*][*][*][F]
 8 [*][*][F][F][*][*][*][*][*][*]
 7 [F][*][*][*][*][F][*][*][*][F]
 6 [*][*][*][F][F][*][*][*][*][*]
 5 [*][*][*][*][F][*][*][*][*][F]
 4 [F][*][*][*][*][*][*][*][*][*]
 3 [*][*][*][*][*][*][F][*][*][*]
 2 [*][*][F][*][*][*][*][*][*][*]
 1 [*][F][F][*][*][*][*][*][*][F]
 0 [*][*][*][F][F][*][*][*][F][*]
    0  1  2  3  4  5  6  7  8  9
```

以下**并不是**有效的获胜条件，因为有`21`个标记。与上一次输出不同，格`0` `0`被标记：
```console
 9 [F][*][*][*][*][*][*][*][*][F]
 8 [*][*][F][F][*][*][*][*][*][*]
 7 [F][*][*][*][*][F][*][*][*][F]
 6 [*][*][*][F][F][*][*][*][*][*]
 5 [*][*][*][*][F][*][*][*][*][F]
 4 [F][*][*][*][*][*][*][*][*][*]
 3 [*][*][*][*][*][*][F][*][*][*]
 2 [*][*][F][*][*][*][*][*][*][*]
 1 [*][F][F][*][*][*][*][*][*][F]
 0 [F][*][*][F][F][*][*][*][F][*]
    0  1  2  3  4  5  6  7  8  9
```

标记命令的使用和揭示命令相同，`f`和`flag`都是有效的命令名：
```console
Enter a command: f 1 1

Turn: 1
 9 [*][*][*][*][*][*][*][*][*][*]
 8 [*][*][*][*][*][*][*][*][*][*]
 7 [*][*][*][*][*][*][*][*][*][*]
 6 [*][*][*][*][*][*][*][*][*][*]
 5 [*][*][*][*][*][*][*][*][*][*]
 4 [*][*][*][*][*][*][*][*][*][*]
 3 [*][*][*][*][*][*][*][*][*][*]
 2 [*][*][*][*][*][*][*][*][*][*]
 1 [*][F][*][*][*][*][*][*][*][*]
 0 [*][*][*][*][*][*][*][*][*][*]
    0  1  2  3  4  5  6  7  8  9
```

### 猜测命令

你可以使用命令`g`或`guess`来标记一个可能存在地雷的格。此命令同样要求输入格坐标，示例输出如下：
```console
Enter a command: g 1 1

Turn: 1
 9 [*][*][*][*][*][*][*][*][*][*]
 8 [*][*][*][*][*][*][*][*][*][*]
 7 [*][*][*][*][*][*][*][*][*][*]
 6 [*][*][*][*][*][*][*][*][*][*]
 5 [*][*][*][*][*][*][*][*][*][*]
 4 [*][*][*][*][*][*][*][*][*][*]
 3 [*][*][*][*][*][*][*][*][*][*]
 2 [*][*][*][*][*][*][*][*][*][*]
 1 [*][?][*][*][*][*][*][*][*][*]
 0 [*][*][*][*][*][*][*][*][*][*]
    0  1  2  3  4  5  6  7  8  9
```

### 去雾

无雾是用于调试的隐藏命令。该命令可移除迷雾，并显示棋盘上的所有地雷。命令和输出如下：
```console
Enter a command: noFog

Turn: 1
 9 [*][*][*][*][*][*][*][*][*][*]
 8 [*][*][*][@][*][*][@][*][*][@]
 7 [*][@][@][*][*][*][*][*][*][*]
 6 [*][*][*][*][*][*][@][*][*][@]
 5 [*][*][*][*][*][*][*][*][*][*]
 4 [@][*][*][*][*][*][*][@][*][@]
 3 [*][@][@][*][*][*][*][*][*][*]
 2 [@][@][*][*][*][*][*][*][*][@]
 1 [*][*][*][*][*][*][*][*][*][@]
 0 [*][@][*][*][@][*][@][*][@][*]
    0  1  2  3  4  5  6  7  8  9   
```

## 开源协议

项目以`LGPL-3.0`协议开源.